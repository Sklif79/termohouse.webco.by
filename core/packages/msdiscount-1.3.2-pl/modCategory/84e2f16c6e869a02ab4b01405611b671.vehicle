<?php return array (
  'unique_key' => 'category',
  'preserve_keys' => false,
  'update_object' => true,
  'related_objects' => 
  array (
    'Chunks' => 
    array (
      '7b9a175d6f6cdb4f96697a27f33201d1' => 
      array (
        'preserve_keys' => false,
        'update_object' => false,
        'unique_key' => 'name',
        'class' => 'modChunk',
        'object' => '{"id":0,"source":1,"property_preprocess":0,"name":"tpl.msProducts.discount.row","description":"","editor_type":0,"category":0,"cache_type":0,"snippet":"<div class=\\"row ms2_product\\">\\n\\t<div class=\\"span2 col-md-2\\"><img src=\\"[[+thumb:default=`[[++assets_url]]components\\/minishop2\\/img\\/web\\/ms2_small.png`]]\\" width=\\"120\\" height=\\"90\\" \\/><\\/div>\\n\\t<div class=\\"row span10 col-md-10\\">\\n\\t\\t<form method=\\"post\\" class=\\"ms2_form\\">\\n\\t\\t\\t<a href=\\"[[~[[+id]]]]\\">[[+pagetitle]]<\\/a>\\n\\t\\t\\t<span class=\\"flags\\">[[+new]] [[+popular]] [[+favorite]]<\\/span>\\n\\t\\t\\t<span class=\\"price\\">[[+price]] [[%ms2_frontend_currency]][[+remains]]<\\/span>\\n\\t\\t\\t[[+old_price]]\\n\\t\\t\\t<button class=\\"btn btn-default\\" type=\\"submit\\" name=\\"ms2_action\\" value=\\"cart\\/add\\"><i class=\\"glyphicon glyphicon-barcode\\"><\\/i> [[%ms2_frontend_add_to_cart]]<\\/button>\\n\\t\\t\\t<input type=\\"hidden\\" name=\\"id\\" value=\\"[[+id]]\\">\\n\\t\\t\\t<input type=\\"hidden\\" name=\\"count\\" value=\\"1\\">\\n\\t\\t\\t<input type=\\"hidden\\" name=\\"options\\" value=\\"[]\\">\\n\\t\\t<\\/form>\\n\\t\\t<p><small>[[+introtext]]<\\/small><\\/p>\\n\\t<\\/div>\\n<\\/div>\\n<br\\/><br\\/>\\n<!--minishop2_popular <i class=\\"glyphicon glyphicon-star\\" title=\\"[[%ms2_frontend_popular]]\\"><\\/i>-->\\n<!--minishop2_new <i class=\\"glyphicon glyphicon-flag\\" title=\\"[[%ms2_frontend_new]]\\"><\\/i>-->\\n<!--minishop2_favorite <i class=\\"glyphicon glyphicon-bookmark\\" title=\\"[[%ms2_frontend_favorite]]\\"><\\/i>-->\\n<!--minishop2_old_price <span class=\\"old_price\\">[[+old_price]] [[%ms2_frontend_currency]]<\\/span>-->\\n<!--minishop2_remains  (-[[+sale_discount]] \\u2014 <span class=\\"msd_remains\\">[[+remains]]<\\/span>)-->\\n<!--minishop2_!remains  (-[[+sale_discount]])-->","locked":0,"properties":null,"static":0,"static_file":"core\\/components\\/msdiscount\\/elements\\/chunks\\/chunk.msd_product_row.tpl","content":"<div class=\\"row ms2_product\\">\\n\\t<div class=\\"span2 col-md-2\\"><img src=\\"[[+thumb:default=`[[++assets_url]]components\\/minishop2\\/img\\/web\\/ms2_small.png`]]\\" width=\\"120\\" height=\\"90\\" \\/><\\/div>\\n\\t<div class=\\"row span10 col-md-10\\">\\n\\t\\t<form method=\\"post\\" class=\\"ms2_form\\">\\n\\t\\t\\t<a href=\\"[[~[[+id]]]]\\">[[+pagetitle]]<\\/a>\\n\\t\\t\\t<span class=\\"flags\\">[[+new]] [[+popular]] [[+favorite]]<\\/span>\\n\\t\\t\\t<span class=\\"price\\">[[+price]] [[%ms2_frontend_currency]][[+remains]]<\\/span>\\n\\t\\t\\t[[+old_price]]\\n\\t\\t\\t<button class=\\"btn btn-default\\" type=\\"submit\\" name=\\"ms2_action\\" value=\\"cart\\/add\\"><i class=\\"glyphicon glyphicon-barcode\\"><\\/i> [[%ms2_frontend_add_to_cart]]<\\/button>\\n\\t\\t\\t<input type=\\"hidden\\" name=\\"id\\" value=\\"[[+id]]\\">\\n\\t\\t\\t<input type=\\"hidden\\" name=\\"count\\" value=\\"1\\">\\n\\t\\t\\t<input type=\\"hidden\\" name=\\"options\\" value=\\"[]\\">\\n\\t\\t<\\/form>\\n\\t\\t<p><small>[[+introtext]]<\\/small><\\/p>\\n\\t<\\/div>\\n<\\/div>\\n<br\\/><br\\/>\\n<!--minishop2_popular <i class=\\"glyphicon glyphicon-star\\" title=\\"[[%ms2_frontend_popular]]\\"><\\/i>-->\\n<!--minishop2_new <i class=\\"glyphicon glyphicon-flag\\" title=\\"[[%ms2_frontend_new]]\\"><\\/i>-->\\n<!--minishop2_favorite <i class=\\"glyphicon glyphicon-bookmark\\" title=\\"[[%ms2_frontend_favorite]]\\"><\\/i>-->\\n<!--minishop2_old_price <span class=\\"old_price\\">[[+old_price]] [[%ms2_frontend_currency]]<\\/span>-->\\n<!--minishop2_remains  (-[[+sale_discount]] \\u2014 <span class=\\"msd_remains\\">[[+remains]]<\\/span>)-->\\n<!--minishop2_!remains  (-[[+sale_discount]])-->"}',
        'guid' => '81abe73b9f667ab1f7ea8c94b3435fc5',
        'native_key' => 0,
        'signature' => '180e256bbb6bd6f1722493daf863dc37',
      ),
      '1206aa07090cc60cc2360f88f30851a8' => 
      array (
        'preserve_keys' => false,
        'update_object' => false,
        'unique_key' => 'name',
        'class' => 'modChunk',
        'object' => '{"id":0,"source":1,"property_preprocess":0,"name":"tpl.msProduct.discount","description":"","editor_type":0,"category":0,"cache_type":0,"snippet":"[[+remains]]\\n<!--minishop2_remains -[[+sale_discount]] \\u2014 <span class=\\"msd_remains\\">[[+remains]]<\\/span>-->\\n<!--minishop2_!remains -[[+sale_discount]]-->","locked":0,"properties":null,"static":0,"static_file":"core\\/components\\/msdiscount\\/elements\\/chunks\\/chunk.msd_discount.tpl","content":"[[+remains]]\\n<!--minishop2_remains -[[+sale_discount]] \\u2014 <span class=\\"msd_remains\\">[[+remains]]<\\/span>-->\\n<!--minishop2_!remains -[[+sale_discount]]-->"}',
        'guid' => 'e9ec2fb46d47d0eef11ebfa9892cb5dc',
        'native_key' => 0,
        'signature' => '725911f0d207bde4482d07409ddb38c9',
      ),
    ),
    'Snippets' => 
    array (
      'd33cedebdf2cd69cd7c1ce815de4fd0e' => 
      array (
        'preserve_keys' => false,
        'update_object' => true,
        'unique_key' => 'name',
        'class' => 'modSnippet',
        'object' => '{"id":0,"source":1,"property_preprocess":0,"name":"msdBuyNow","description":"","editor_type":0,"category":0,"cache_type":0,"snippet":"\\/** @var array $scriptProperties *\\/\\n\\/** @var pdoTools $pdoTools *\\/\\n$pdoTools = $modx->getService(\'pdoTools\');\\n\\/** @var msDiscount $msDiscount *\\/\\n$msDiscount = $modx->getService(\'msDiscount\');\\nif (!empty($frontend_css)) {\\n\\t$frontend_css = str_replace(\'[[+assetsUrl]]\', $msDiscount->config[\'assetsUrl\'], $frontend_css);\\n\\t$modx->regClientCSS($frontend_css);\\n}\\nif (!empty($frontend_js)) {\\n\\t$frontend_js = str_replace(\'[[+assetsUrl]]\', $msDiscount->config[\'assetsUrl\'], $frontend_js);\\n\\t$modx->regClientScript($frontend_js);\\n}\\n\\n$date = date(\'Y-m-d H:i:s\');\\n$pdoTools->setStore(\'msd_date\', $date);\\n$usergroups = array_keys($msDiscount->getUserGroups($modx->user->id));\\n$sales = $msDiscount->getSales($date, !empty($scriptProperties[\'force_date\']));\\nif (!empty($sale)) {\\n\\t$pdoTools->setStore(\'msd_sale\', $sale);\\n\\t$tmp = array_map(\'trim\', explode(\',\', $sale));\\n\\tforeach ($sales as $id => $sale) {\\n\\t\\tif (!in_array($id, $tmp)) {\\n\\t\\t\\tunset($sales[$id]);\\n\\t\\t}\\n\\t}\\n}\\nif (empty($sales)) {\\n\\treturn !empty($showLog) && $modx->user->hasSessionContext(\'mgr\')\\n\\t\\t? $modx->lexicon(\'msd_err_no_sales\')\\n\\t\\t: \'\';\\n}\\n$all = false;\\n$parents_in = array();\\n$parents_out = array();\\nforeach ($sales as $idx => $sale) {\\n\\t\\/\\/ Check user groups\\n\\tif (!empty($sale[\'users\'])) {\\n\\t\\t$required = array();\\n\\t\\tforeach ($sale[\'users\'] as $gid => $type) {\\n\\t\\t\\tif ($type == \'out\' && in_array($gid, $usergroups)) {\\n\\t\\t\\t\\tunset($sales[$idx]);\\n\\t\\t\\t\\tcontinue(2);\\n\\t\\t\\t}\\n\\t\\t\\tif ($type == \'in\') {\\n\\t\\t\\t\\t$required[] = $gid;\\n\\t\\t\\t}\\n\\t\\t}\\n\\t\\tif (!empty($required) && !array_intersect($required, $usergroups)) {\\n\\t\\t\\tunset($sales[$idx]);\\n\\t\\t\\tcontinue;\\n\\t\\t}\\n\\t}\\n\\t\\/\\/ Check product groups\\n\\tif (!empty($sale[\'products\'])) {\\n\\t\\tforeach ($sale[\'products\'] as $gid => $type) {\\n\\t\\t\\t$c = $modx->newQuery(\'modResourceGroupResource\', array(\'document_group\' => $gid));\\n\\t\\t\\t$c->select(\'document\');\\n\\t\\t\\t$tstart = microtime(true);\\n\\t\\t\\tif ($c->prepare() && $c->stmt->execute()) {\\n\\t\\t\\t\\t$modx->queryTime += microtime(true) - $tstart;\\n\\t\\t\\t\\t$modx->executedQueries++;\\n\\t\\t\\t\\tif ($ids = $c->stmt->fetchAll(PDO::FETCH_COLUMN)) {\\n\\t\\t\\t\\t\\tif ($type == \'in\') {\\n\\t\\t\\t\\t\\t\\t$parents_in = array_merge($parents_in, $ids);\\n\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t\\telse {\\n\\t\\t\\t\\t\\t\\t$parents_out = array_merge($parents_out, $ids);\\n\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t}\\n\\t\\t\\t}\\n\\t\\t}\\n\\t}\\n\\t\\/\\/ All products\\n\\telse {\\n\\t\\t$all = true;\\n\\t\\tbreak;\\n\\t}\\n}\\n\\nif (!$parents_in && !$parents_out && !$all) {\\n\\treturn !empty($showLog) && $modx->user->hasSessionContext(\'mgr\')\\n\\t\\t? $modx->lexicon(\'msd_err_no_sales\')\\n\\t\\t: \'\';\\n}\\n\\nif (empty($scriptProperties[\'prepareSnippet\'])) {\\n\\t$scriptProperties[\'prepareSnippet\'] = \'msdGetDiscount\';\\n}\\n\\n$scriptProperties[\'parents\'] = 0;\\nif (!empty($scriptProperties[\'where\'])) {\\n\\t$where = !is_array($scriptProperties[\'where\'])\\n\\t\\t? $modx->fromJSON($scriptProperties[\'where\'])\\n\\t\\t: $scriptProperties[\'where\'];\\n}\\nelse {\\n\\t$where = array();\\n}\\nif (!$all) {\\n\\t$depth = (isset($config[\'depth\']) && $config[\'depth\'] !== \'\')\\n\\t\\t? (integer)$config[\'depth\']\\n\\t\\t: 10;\\n\\tif (!empty($depth) && $depth > 0) {\\n\\t\\t$pids = array();\\n\\t\\t$q = $modx->newQuery(\'modResource\', array(\'id:IN\' => array_merge($parents_in, $parents_out)));\\n\\t\\t$q->select(\'id,context_key\');\\n\\t\\t$tstart = microtime(true);\\n\\t\\tif ($q->prepare() && $q->stmt->execute()) {\\n\\t\\t\\t$modx->queryTime += microtime(true) - $tstart;\\n\\t\\t\\t$modx->executedQueries++;\\n\\t\\t\\twhile ($row = $q->stmt->fetch(PDO::FETCH_ASSOC)) {\\n\\t\\t\\t\\t$pids[$row[\'id\']] = $row[\'context_key\'];\\n\\t\\t\\t}\\n\\t\\t}\\n\\t\\tforeach ($pids as $k => $v) {\\n\\t\\t\\tif (!is_numeric($k)) {\\n\\t\\t\\t\\tcontinue;\\n\\t\\t\\t}\\n\\t\\t\\telseif (in_array($k, $parents_in)) {\\n\\t\\t\\t\\t$parents_in = array_merge($parents_in, $modx->getChildIds($k, $depth, array(\'context\' => $v)));\\n\\t\\t\\t}\\n\\t\\t\\telse {\\n\\t\\t\\t\\t$parents_out = array_merge($parents_out, $modx->getChildIds($k, $depth, array(\'context\' => $v)));\\n\\t\\t\\t}\\n\\t\\t}\\n\\t\\tif (empty($parents_in)) {\\n\\t\\t\\t$parents_in = $modx->getChildIds(0, $depth, array(\'context\' => $this->config[\'context\']));\\n\\t\\t}\\n\\t\\t\\/\\/ Support of miniShop2 categories\\n\\t\\t$members = array();\\n\\t\\tif (!empty($parents_in) || !empty($parents_out)) {\\n\\t\\t\\t$q = $modx->newQuery(\'msCategoryMember\');\\n\\t\\t\\tif (!empty($parents_in)) {\\n\\t\\t\\t\\t$q->where(array(\'category_id:IN\' => $parents_in));\\n\\t\\t\\t}\\n\\t\\t\\tif (!empty($parents_out)) {\\n\\t\\t\\t\\t$q->where(array(\'category_id:NOT IN\' => $parents_out));\\n\\t\\t\\t}\\n\\t\\t\\t$q->select(\'product_id\');\\n\\t\\t\\t$tstart = microtime(true);\\n\\t\\t\\tif ($q->prepare() && $q->stmt->execute()) {\\n\\t\\t\\t\\t$modx->queryTime += microtime(true) - $tstart;\\n\\t\\t\\t\\t$modx->executedQueries++;\\n\\t\\t\\t\\t$members = $q->stmt->fetchAll(PDO::FETCH_COLUMN);\\n\\t\\t\\t}\\n\\t\\t}\\n\\t\\t\\/\\/ Add parent to conditions\\n\\t\\tif (!empty($parents_in) && !empty($members)) {\\n\\t\\t\\t$members = array_merge($members, $parents_in);\\n\\t\\t\\t$where[] = array(\\n\\t\\t\\t\\t\'parent:IN\' => $parents_in,\\n\\t\\t\\t\\t\'OR:id:IN\' => $members,\\n\\t\\t\\t);\\n\\t\\t}\\n\\t\\telseif (!empty($parents_in)) {\\n\\t\\t\\t$where[] = array(\\n\\t\\t\\t\\t\'parent:IN\' => $parents_in,\\n\\t\\t\\t\\t\'OR:id:IN\' => $parents_in,\\n\\t\\t\\t);\\n\\t\\t}\\n\\t\\tif (!empty($parents_out)) {\\n\\t\\t\\t$where[] = array(\\n\\t\\t\\t\\t\'parent:NOT IN\' => $parents_out,\\n\\t\\t\\t\\t\'AND:id:NOT IN\' => $parents_out,\\n\\t\\t\\t);\\n\\t\\t}\\n\\t}\\n}\\n$scriptProperties[\'where\'] = $modx->toJSON($where);\\n\\nreturn $modx->runSnippet(\'msProducts\', $scriptProperties);","locked":0,"properties":"a:5:{s:4:\\"sale\\";a:7:{s:4:\\"name\\";s:4:\\"sale\\";s:4:\\"desc\\";s:20:\\"msdiscount_prop_sale\\";s:4:\\"type\\";s:9:\\"textfield\\";s:7:\\"options\\";a:0:{}s:5:\\"value\\";s:0:\\"\\";s:7:\\"lexicon\\";s:21:\\"msdiscount:properties\\";s:4:\\"area\\";s:0:\\"\\";}s:3:\\"tpl\\";a:7:{s:4:\\"name\\";s:3:\\"tpl\\";s:4:\\"desc\\";s:19:\\"msdiscount_prop_tpl\\";s:4:\\"type\\";s:9:\\"textfield\\";s:7:\\"options\\";a:0:{}s:5:\\"value\\";s:27:\\"tpl.msProducts.discount.row\\";s:7:\\"lexicon\\";s:21:\\"msdiscount:properties\\";s:4:\\"area\\";s:0:\\"\\";}s:12:\\"frontend_css\\";a:7:{s:4:\\"name\\";s:12:\\"frontend_css\\";s:4:\\"desc\\";s:28:\\"msdiscount_prop_frontend_css\\";s:4:\\"type\\";s:9:\\"textfield\\";s:7:\\"options\\";a:0:{}s:5:\\"value\\";s:30:\\"[[+assetsUrl]]css\\/web\\/main.css\\";s:7:\\"lexicon\\";s:21:\\"msdiscount:properties\\";s:4:\\"area\\";s:0:\\"\\";}s:11:\\"frontend_js\\";a:7:{s:4:\\"name\\";s:11:\\"frontend_js\\";s:4:\\"desc\\";s:27:\\"msdiscount_prop_frontend_js\\";s:4:\\"type\\";s:9:\\"textfield\\";s:7:\\"options\\";a:0:{}s:5:\\"value\\";s:31:\\"[[+assetsUrl]]js\\/web\\/default.js\\";s:7:\\"lexicon\\";s:21:\\"msdiscount:properties\\";s:4:\\"area\\";s:0:\\"\\";}s:10:\\"force_date\\";a:7:{s:4:\\"name\\";s:10:\\"force_date\\";s:4:\\"desc\\";s:26:\\"msdiscount_prop_force_date\\";s:4:\\"type\\";s:13:\\"combo-boolean\\";s:7:\\"options\\";a:0:{}s:5:\\"value\\";b:1;s:7:\\"lexicon\\";s:21:\\"msdiscount:properties\\";s:4:\\"area\\";s:0:\\"\\";}}","moduleguid":"","static":0,"static_file":"core\\/components\\/msdiscount\\/elements\\/snippets\\/snippet.msdbuynow.php","content":"\\/** @var array $scriptProperties *\\/\\n\\/** @var pdoTools $pdoTools *\\/\\n$pdoTools = $modx->getService(\'pdoTools\');\\n\\/** @var msDiscount $msDiscount *\\/\\n$msDiscount = $modx->getService(\'msDiscount\');\\nif (!empty($frontend_css)) {\\n\\t$frontend_css = str_replace(\'[[+assetsUrl]]\', $msDiscount->config[\'assetsUrl\'], $frontend_css);\\n\\t$modx->regClientCSS($frontend_css);\\n}\\nif (!empty($frontend_js)) {\\n\\t$frontend_js = str_replace(\'[[+assetsUrl]]\', $msDiscount->config[\'assetsUrl\'], $frontend_js);\\n\\t$modx->regClientScript($frontend_js);\\n}\\n\\n$date = date(\'Y-m-d H:i:s\');\\n$pdoTools->setStore(\'msd_date\', $date);\\n$usergroups = array_keys($msDiscount->getUserGroups($modx->user->id));\\n$sales = $msDiscount->getSales($date, !empty($scriptProperties[\'force_date\']));\\nif (!empty($sale)) {\\n\\t$pdoTools->setStore(\'msd_sale\', $sale);\\n\\t$tmp = array_map(\'trim\', explode(\',\', $sale));\\n\\tforeach ($sales as $id => $sale) {\\n\\t\\tif (!in_array($id, $tmp)) {\\n\\t\\t\\tunset($sales[$id]);\\n\\t\\t}\\n\\t}\\n}\\nif (empty($sales)) {\\n\\treturn !empty($showLog) && $modx->user->hasSessionContext(\'mgr\')\\n\\t\\t? $modx->lexicon(\'msd_err_no_sales\')\\n\\t\\t: \'\';\\n}\\n$all = false;\\n$parents_in = array();\\n$parents_out = array();\\nforeach ($sales as $idx => $sale) {\\n\\t\\/\\/ Check user groups\\n\\tif (!empty($sale[\'users\'])) {\\n\\t\\t$required = array();\\n\\t\\tforeach ($sale[\'users\'] as $gid => $type) {\\n\\t\\t\\tif ($type == \'out\' && in_array($gid, $usergroups)) {\\n\\t\\t\\t\\tunset($sales[$idx]);\\n\\t\\t\\t\\tcontinue(2);\\n\\t\\t\\t}\\n\\t\\t\\tif ($type == \'in\') {\\n\\t\\t\\t\\t$required[] = $gid;\\n\\t\\t\\t}\\n\\t\\t}\\n\\t\\tif (!empty($required) && !array_intersect($required, $usergroups)) {\\n\\t\\t\\tunset($sales[$idx]);\\n\\t\\t\\tcontinue;\\n\\t\\t}\\n\\t}\\n\\t\\/\\/ Check product groups\\n\\tif (!empty($sale[\'products\'])) {\\n\\t\\tforeach ($sale[\'products\'] as $gid => $type) {\\n\\t\\t\\t$c = $modx->newQuery(\'modResourceGroupResource\', array(\'document_group\' => $gid));\\n\\t\\t\\t$c->select(\'document\');\\n\\t\\t\\t$tstart = microtime(true);\\n\\t\\t\\tif ($c->prepare() && $c->stmt->execute()) {\\n\\t\\t\\t\\t$modx->queryTime += microtime(true) - $tstart;\\n\\t\\t\\t\\t$modx->executedQueries++;\\n\\t\\t\\t\\tif ($ids = $c->stmt->fetchAll(PDO::FETCH_COLUMN)) {\\n\\t\\t\\t\\t\\tif ($type == \'in\') {\\n\\t\\t\\t\\t\\t\\t$parents_in = array_merge($parents_in, $ids);\\n\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t\\telse {\\n\\t\\t\\t\\t\\t\\t$parents_out = array_merge($parents_out, $ids);\\n\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t}\\n\\t\\t\\t}\\n\\t\\t}\\n\\t}\\n\\t\\/\\/ All products\\n\\telse {\\n\\t\\t$all = true;\\n\\t\\tbreak;\\n\\t}\\n}\\n\\nif (!$parents_in && !$parents_out && !$all) {\\n\\treturn !empty($showLog) && $modx->user->hasSessionContext(\'mgr\')\\n\\t\\t? $modx->lexicon(\'msd_err_no_sales\')\\n\\t\\t: \'\';\\n}\\n\\nif (empty($scriptProperties[\'prepareSnippet\'])) {\\n\\t$scriptProperties[\'prepareSnippet\'] = \'msdGetDiscount\';\\n}\\n\\n$scriptProperties[\'parents\'] = 0;\\nif (!empty($scriptProperties[\'where\'])) {\\n\\t$where = !is_array($scriptProperties[\'where\'])\\n\\t\\t? $modx->fromJSON($scriptProperties[\'where\'])\\n\\t\\t: $scriptProperties[\'where\'];\\n}\\nelse {\\n\\t$where = array();\\n}\\nif (!$all) {\\n\\t$depth = (isset($config[\'depth\']) && $config[\'depth\'] !== \'\')\\n\\t\\t? (integer)$config[\'depth\']\\n\\t\\t: 10;\\n\\tif (!empty($depth) && $depth > 0) {\\n\\t\\t$pids = array();\\n\\t\\t$q = $modx->newQuery(\'modResource\', array(\'id:IN\' => array_merge($parents_in, $parents_out)));\\n\\t\\t$q->select(\'id,context_key\');\\n\\t\\t$tstart = microtime(true);\\n\\t\\tif ($q->prepare() && $q->stmt->execute()) {\\n\\t\\t\\t$modx->queryTime += microtime(true) - $tstart;\\n\\t\\t\\t$modx->executedQueries++;\\n\\t\\t\\twhile ($row = $q->stmt->fetch(PDO::FETCH_ASSOC)) {\\n\\t\\t\\t\\t$pids[$row[\'id\']] = $row[\'context_key\'];\\n\\t\\t\\t}\\n\\t\\t}\\n\\t\\tforeach ($pids as $k => $v) {\\n\\t\\t\\tif (!is_numeric($k)) {\\n\\t\\t\\t\\tcontinue;\\n\\t\\t\\t}\\n\\t\\t\\telseif (in_array($k, $parents_in)) {\\n\\t\\t\\t\\t$parents_in = array_merge($parents_in, $modx->getChildIds($k, $depth, array(\'context\' => $v)));\\n\\t\\t\\t}\\n\\t\\t\\telse {\\n\\t\\t\\t\\t$parents_out = array_merge($parents_out, $modx->getChildIds($k, $depth, array(\'context\' => $v)));\\n\\t\\t\\t}\\n\\t\\t}\\n\\t\\tif (empty($parents_in)) {\\n\\t\\t\\t$parents_in = $modx->getChildIds(0, $depth, array(\'context\' => $this->config[\'context\']));\\n\\t\\t}\\n\\t\\t\\/\\/ Support of miniShop2 categories\\n\\t\\t$members = array();\\n\\t\\tif (!empty($parents_in) || !empty($parents_out)) {\\n\\t\\t\\t$q = $modx->newQuery(\'msCategoryMember\');\\n\\t\\t\\tif (!empty($parents_in)) {\\n\\t\\t\\t\\t$q->where(array(\'category_id:IN\' => $parents_in));\\n\\t\\t\\t}\\n\\t\\t\\tif (!empty($parents_out)) {\\n\\t\\t\\t\\t$q->where(array(\'category_id:NOT IN\' => $parents_out));\\n\\t\\t\\t}\\n\\t\\t\\t$q->select(\'product_id\');\\n\\t\\t\\t$tstart = microtime(true);\\n\\t\\t\\tif ($q->prepare() && $q->stmt->execute()) {\\n\\t\\t\\t\\t$modx->queryTime += microtime(true) - $tstart;\\n\\t\\t\\t\\t$modx->executedQueries++;\\n\\t\\t\\t\\t$members = $q->stmt->fetchAll(PDO::FETCH_COLUMN);\\n\\t\\t\\t}\\n\\t\\t}\\n\\t\\t\\/\\/ Add parent to conditions\\n\\t\\tif (!empty($parents_in) && !empty($members)) {\\n\\t\\t\\t$members = array_merge($members, $parents_in);\\n\\t\\t\\t$where[] = array(\\n\\t\\t\\t\\t\'parent:IN\' => $parents_in,\\n\\t\\t\\t\\t\'OR:id:IN\' => $members,\\n\\t\\t\\t);\\n\\t\\t}\\n\\t\\telseif (!empty($parents_in)) {\\n\\t\\t\\t$where[] = array(\\n\\t\\t\\t\\t\'parent:IN\' => $parents_in,\\n\\t\\t\\t\\t\'OR:id:IN\' => $parents_in,\\n\\t\\t\\t);\\n\\t\\t}\\n\\t\\tif (!empty($parents_out)) {\\n\\t\\t\\t$where[] = array(\\n\\t\\t\\t\\t\'parent:NOT IN\' => $parents_out,\\n\\t\\t\\t\\t\'AND:id:NOT IN\' => $parents_out,\\n\\t\\t\\t);\\n\\t\\t}\\n\\t}\\n}\\n$scriptProperties[\'where\'] = $modx->toJSON($where);\\n\\nreturn $modx->runSnippet(\'msProducts\', $scriptProperties);"}',
        'guid' => 'df1bde0f8287449984dddb7cf6770714',
        'native_key' => 0,
        'signature' => '1a486ef2ea1446f376fc55c23ce65f8a',
      ),
      '1ab3926d808ea71bc900e1ef1618112e' => 
      array (
        'preserve_keys' => false,
        'update_object' => true,
        'unique_key' => 'name',
        'class' => 'modSnippet',
        'object' => '{"id":0,"source":1,"property_preprocess":0,"name":"msdGetDiscount","description":"","editor_type":0,"category":0,"cache_type":0,"snippet":"\\/** @var msDiscount $msDiscount *\\/\\n\\/** @var pdoTools $pdoTools *\\/\\n$pdoTools = $modx->getService(\'pdoTools\');\\n$msDiscount = $modx->getService(\'msDiscount\');\\n\\nif (!empty($row) && is_array($row)) {\\n    $mode = \'prepare\';\\n    if (!empty($row[\'id\'])) {\\n        $id = $row[\'id\'];\\n    }\\n}\\nelse {\\n    $mode = \'standalone\';\\n    if (!empty($frontend_css)) {\\n        $frontend_css = str_replace(\'[[+assetsUrl]]\', $msDiscount->config[\'assetsUrl\'], $frontend_css);\\n        $modx->regClientCSS($frontend_css);\\n    }\\n    if (!empty($frontend_js)) {\\n        $frontend_js = str_replace(\'[[+assetsUrl]]\', $msDiscount->config[\'assetsUrl\'], $frontend_js);\\n        $modx->regClientScript($frontend_js);\\n    }\\n    if (empty($id)) {\\n        $id = $modx->resource->id;\\n    }\\n}\\n\\nif (!$product = $modx->getObject(\'msProductData\', $id)) return;\\n$users = $msDiscount->getUserGroups($modx->user->id);\\n$products = $msDiscount->getProductGroups($id);\\n$date = date(\'Y-m-d H:i:s\');\\n$sales = $msDiscount->getSales($date);\\nif (empty($sale)) {\\n\\t$sale = $pdoTools->getStore(\'msd_sale\');\\n}\\n$sale_filter = array_diff(explode(\',\', $sale), array(\'\'));;\\n$discounts = array(\\n    \'percent\' => \'0%\',    \\/\\/ Discount in percent\\n    \'absolute\' => 0,    \\/\\/ Discount in absolute value\\n    \'remains\' => 0,     \\/\\/ Remains for bye now\\n);\\n\\n\\/\\/ Get discount by sales\\nif (!empty($sales)) {\\n    foreach ($sales as $sale) {\\n        if (!empty($sale_filter) && !in_array($sale[\'id\'], $sale_filter)) {\\n            continue;\\n        }\\n        $exclude = false;\\n        \\/\\/ Exclude groups if they are specified in sale\\n        \\/\\/ And convert relation to discount\\n        foreach (array(\'users\',\'products\') as $type) {\\n            foreach ($sale[$type] as $group_id => $relation) {\\n                if ($relation != \'in\') {\\n                    unset($sale[$type][$group_id]);\\n                    if (array_key_exists($group_id, ${$type})) {\\n                        $exclude = true;\\n                        break(2);\\n                    }\\n                }\\n                elseif (array_key_exists($group_id, ${$type})) {\\n                    $sale[$type][$group_id] = ${$type}[$group_id];\\n                }\\n                else {\\n                    $sale[$type][$group_id] = null;\\n                }\\n            }\\n        }\\n        if ($exclude) {continue;}\\n        $users_in = array_intersect(array_keys($sale[\'users\']), array_keys($users));\\n        $products_in = array_intersect(array_keys($sale[\'products\']), array_keys($products));\\n\\n        if (empty($sale[\'users\']) && empty($sale[\'products\'])) {\\n            $discount = $sale[\'discount\'];\\n            $ends = isset($sale[\'ends\']) ? $sale[\'ends\'] : \'0000-00-00 00:00:00\';\\n            $discounts = $msDiscount->compareDiscount($discount, $discounts, $ends);\\n            \\/\\/ Check group discount\\n            foreach (array(\'users\', \'products\') as $type) {\\n                foreach (${$type} as $group_id => $discount) {\\n                    $discounts = $msDiscount->compareDiscount($discount, $discounts, $ends);\\n                }\\n            }\\n        }\\n        else {\\n            if (!empty($sale[\'users\']) && !empty($sale[\'products\'])) {\\n                if (!empty($users_in) && !empty($products_in)) {\\n                    $discount = $sale[\'discount\'];\\n                    $ends = isset($sale[\'ends\']) ? $sale[\'ends\'] : \'0000-00-00 00:00:00\';\\n                    $discounts = $msDiscount->compareDiscount($discount, $discounts, $ends);\\n                }\\n                else {\\n                    continue;\\n                }\\n            }\\n            if (!empty($sale[\'users\']) && !empty($users_in)) {\\n                $discount = $sale[\'discount\'];\\n                $ends = isset($sale[\'ends\']) ? $sale[\'ends\'] : \'0000-00-00 00:00:00\';\\n                $discounts = $msDiscount->compareDiscount($discount, $discounts, $ends);\\n                \\/\\/ Check group discounts\\n                foreach ($sale[\'users\'] as $group_id => $discount) {\\n                    $discounts = $msDiscount->compareDiscount($discount, $discounts, $ends);\\n                }\\n            }\\n            elseif (!empty($sale[\'products\']) && !empty($products_in)) {\\n                $discount = $sale[\'discount\'];\\n                $ends = isset($sale[\'ends\']) ? $sale[\'ends\'] : \'0000-00-00 00:00:00\';\\n                $discounts = $msDiscount->compareDiscount($discount, $discounts, $ends);\\n                \\/\\/ Check group discounts\\n                foreach ($sale[\'products\'] as $group_id => $discount) {\\n                    $discounts = $msDiscount->compareDiscount($discount, $discounts, $ends);\\n                }\\n            }\\n            if (empty($sale[\'users\']) || empty($sale[\'products\'])) {\\n                \\/\\/ Check group discounts\\n                foreach (array(\'users\', \'products\') as $type) {\\n                    foreach (${$type} as $group_id => $discount) {\\n                        $discounts = $msDiscount->compareDiscount($discount, $discounts, $ends);\\n                    }\\n                }\\n            }\\n        }\\n    }\\n}\\nelse {\\n    \\/\\/ Check group discounts\\n    foreach (array(\'users\', \'products\') as $type) {\\n        foreach (${$type} as $group_id => $discount) {\\n            $ends = \'0000-00-00 00:00:00\';\\n            $discounts = $msDiscount->compareDiscount($discount, $discounts, $ends);\\n        }\\n    }\\n}\\n\\nif ($discounts[\'percent\'] == \'0%\' && $discounts[\'absolute\'] == 0) {\\n    return;\\n}\\nelse {\\n    if ($discounts[\'percent\'] != \'0%\') {\\n        $tmp = ($price \\/ 100) * intval($discounts[\'percent\']);\\n        $discounts[\'percent_abs\'] = $tmp;\\n    }\\n    else {\\n        $discounts[\'percent_abs\'] = 0;\\n    }\\n\\n    $discount = $discounts[\'absolute\'] > $discounts[\'percent_abs\']\\n        ? $discounts[\'absolute\']\\n        : $discounts[\'percent\'];\\n}\\n\\n$arr = array(\\n    \'sale_discount\' => $discount,\\n    \'remains\' => $discounts[\'remains\'] > 0 ? $discounts[\'remains\'] : 0,\\n);\\nif ($mode == \'standalone\') {\\n    $pdoTools->config[\'nestedChunkPrefix\'] = \'minishop2_\';\\n\\n    return !empty($tpl)\\n        ? $pdoTools->getChunk($tpl, $arr)\\n        : print_r($arr, true);\\n}\\nelseif (!empty($row)) {\\n    $row = array_merge($row, $arr);\\n\\n    return $modx->toJSON($row);\\n}","locked":0,"properties":"a:5:{s:2:\\"id\\";a:7:{s:4:\\"name\\";s:2:\\"id\\";s:4:\\"desc\\";s:18:\\"msdiscount_prop_id\\";s:4:\\"type\\";s:11:\\"numberfield\\";s:7:\\"options\\";a:0:{}s:5:\\"value\\";s:0:\\"\\";s:7:\\"lexicon\\";s:21:\\"msdiscount:properties\\";s:4:\\"area\\";s:0:\\"\\";}s:4:\\"sale\\";a:7:{s:4:\\"name\\";s:4:\\"sale\\";s:4:\\"desc\\";s:20:\\"msdiscount_prop_sale\\";s:4:\\"type\\";s:9:\\"textfield\\";s:7:\\"options\\";a:0:{}s:5:\\"value\\";s:0:\\"\\";s:7:\\"lexicon\\";s:21:\\"msdiscount:properties\\";s:4:\\"area\\";s:0:\\"\\";}s:3:\\"tpl\\";a:7:{s:4:\\"name\\";s:3:\\"tpl\\";s:4:\\"desc\\";s:19:\\"msdiscount_prop_tpl\\";s:4:\\"type\\";s:9:\\"textfield\\";s:7:\\"options\\";a:0:{}s:5:\\"value\\";s:22:\\"tpl.msProduct.discount\\";s:7:\\"lexicon\\";s:21:\\"msdiscount:properties\\";s:4:\\"area\\";s:0:\\"\\";}s:12:\\"frontend_css\\";a:7:{s:4:\\"name\\";s:12:\\"frontend_css\\";s:4:\\"desc\\";s:28:\\"msdiscount_prop_frontend_css\\";s:4:\\"type\\";s:9:\\"textfield\\";s:7:\\"options\\";a:0:{}s:5:\\"value\\";s:30:\\"[[+assetsUrl]]css\\/web\\/main.css\\";s:7:\\"lexicon\\";s:21:\\"msdiscount:properties\\";s:4:\\"area\\";s:0:\\"\\";}s:11:\\"frontend_js\\";a:7:{s:4:\\"name\\";s:11:\\"frontend_js\\";s:4:\\"desc\\";s:27:\\"msdiscount_prop_frontend_js\\";s:4:\\"type\\";s:9:\\"textfield\\";s:7:\\"options\\";a:0:{}s:5:\\"value\\";s:31:\\"[[+assetsUrl]]js\\/web\\/default.js\\";s:7:\\"lexicon\\";s:21:\\"msdiscount:properties\\";s:4:\\"area\\";s:0:\\"\\";}}","moduleguid":"","static":0,"static_file":"core\\/components\\/msdiscount\\/elements\\/snippets\\/snippet.msdgetdiscount.php","content":"\\/** @var msDiscount $msDiscount *\\/\\n\\/** @var pdoTools $pdoTools *\\/\\n$pdoTools = $modx->getService(\'pdoTools\');\\n$msDiscount = $modx->getService(\'msDiscount\');\\n\\nif (!empty($row) && is_array($row)) {\\n    $mode = \'prepare\';\\n    if (!empty($row[\'id\'])) {\\n        $id = $row[\'id\'];\\n    }\\n}\\nelse {\\n    $mode = \'standalone\';\\n    if (!empty($frontend_css)) {\\n        $frontend_css = str_replace(\'[[+assetsUrl]]\', $msDiscount->config[\'assetsUrl\'], $frontend_css);\\n        $modx->regClientCSS($frontend_css);\\n    }\\n    if (!empty($frontend_js)) {\\n        $frontend_js = str_replace(\'[[+assetsUrl]]\', $msDiscount->config[\'assetsUrl\'], $frontend_js);\\n        $modx->regClientScript($frontend_js);\\n    }\\n    if (empty($id)) {\\n        $id = $modx->resource->id;\\n    }\\n}\\n\\nif (!$product = $modx->getObject(\'msProductData\', $id)) return;\\n$users = $msDiscount->getUserGroups($modx->user->id);\\n$products = $msDiscount->getProductGroups($id);\\n$date = date(\'Y-m-d H:i:s\');\\n$sales = $msDiscount->getSales($date);\\nif (empty($sale)) {\\n\\t$sale = $pdoTools->getStore(\'msd_sale\');\\n}\\n$sale_filter = array_diff(explode(\',\', $sale), array(\'\'));;\\n$discounts = array(\\n    \'percent\' => \'0%\',    \\/\\/ Discount in percent\\n    \'absolute\' => 0,    \\/\\/ Discount in absolute value\\n    \'remains\' => 0,     \\/\\/ Remains for bye now\\n);\\n\\n\\/\\/ Get discount by sales\\nif (!empty($sales)) {\\n    foreach ($sales as $sale) {\\n        if (!empty($sale_filter) && !in_array($sale[\'id\'], $sale_filter)) {\\n            continue;\\n        }\\n        $exclude = false;\\n        \\/\\/ Exclude groups if they are specified in sale\\n        \\/\\/ And convert relation to discount\\n        foreach (array(\'users\',\'products\') as $type) {\\n            foreach ($sale[$type] as $group_id => $relation) {\\n                if ($relation != \'in\') {\\n                    unset($sale[$type][$group_id]);\\n                    if (array_key_exists($group_id, ${$type})) {\\n                        $exclude = true;\\n                        break(2);\\n                    }\\n                }\\n                elseif (array_key_exists($group_id, ${$type})) {\\n                    $sale[$type][$group_id] = ${$type}[$group_id];\\n                }\\n                else {\\n                    $sale[$type][$group_id] = null;\\n                }\\n            }\\n        }\\n        if ($exclude) {continue;}\\n        $users_in = array_intersect(array_keys($sale[\'users\']), array_keys($users));\\n        $products_in = array_intersect(array_keys($sale[\'products\']), array_keys($products));\\n\\n        if (empty($sale[\'users\']) && empty($sale[\'products\'])) {\\n            $discount = $sale[\'discount\'];\\n            $ends = isset($sale[\'ends\']) ? $sale[\'ends\'] : \'0000-00-00 00:00:00\';\\n            $discounts = $msDiscount->compareDiscount($discount, $discounts, $ends);\\n            \\/\\/ Check group discount\\n            foreach (array(\'users\', \'products\') as $type) {\\n                foreach (${$type} as $group_id => $discount) {\\n                    $discounts = $msDiscount->compareDiscount($discount, $discounts, $ends);\\n                }\\n            }\\n        }\\n        else {\\n            if (!empty($sale[\'users\']) && !empty($sale[\'products\'])) {\\n                if (!empty($users_in) && !empty($products_in)) {\\n                    $discount = $sale[\'discount\'];\\n                    $ends = isset($sale[\'ends\']) ? $sale[\'ends\'] : \'0000-00-00 00:00:00\';\\n                    $discounts = $msDiscount->compareDiscount($discount, $discounts, $ends);\\n                }\\n                else {\\n                    continue;\\n                }\\n            }\\n            if (!empty($sale[\'users\']) && !empty($users_in)) {\\n                $discount = $sale[\'discount\'];\\n                $ends = isset($sale[\'ends\']) ? $sale[\'ends\'] : \'0000-00-00 00:00:00\';\\n                $discounts = $msDiscount->compareDiscount($discount, $discounts, $ends);\\n                \\/\\/ Check group discounts\\n                foreach ($sale[\'users\'] as $group_id => $discount) {\\n                    $discounts = $msDiscount->compareDiscount($discount, $discounts, $ends);\\n                }\\n            }\\n            elseif (!empty($sale[\'products\']) && !empty($products_in)) {\\n                $discount = $sale[\'discount\'];\\n                $ends = isset($sale[\'ends\']) ? $sale[\'ends\'] : \'0000-00-00 00:00:00\';\\n                $discounts = $msDiscount->compareDiscount($discount, $discounts, $ends);\\n                \\/\\/ Check group discounts\\n                foreach ($sale[\'products\'] as $group_id => $discount) {\\n                    $discounts = $msDiscount->compareDiscount($discount, $discounts, $ends);\\n                }\\n            }\\n            if (empty($sale[\'users\']) || empty($sale[\'products\'])) {\\n                \\/\\/ Check group discounts\\n                foreach (array(\'users\', \'products\') as $type) {\\n                    foreach (${$type} as $group_id => $discount) {\\n                        $discounts = $msDiscount->compareDiscount($discount, $discounts, $ends);\\n                    }\\n                }\\n            }\\n        }\\n    }\\n}\\nelse {\\n    \\/\\/ Check group discounts\\n    foreach (array(\'users\', \'products\') as $type) {\\n        foreach (${$type} as $group_id => $discount) {\\n            $ends = \'0000-00-00 00:00:00\';\\n            $discounts = $msDiscount->compareDiscount($discount, $discounts, $ends);\\n        }\\n    }\\n}\\n\\nif ($discounts[\'percent\'] == \'0%\' && $discounts[\'absolute\'] == 0) {\\n    return;\\n}\\nelse {\\n    if ($discounts[\'percent\'] != \'0%\') {\\n        $tmp = ($price \\/ 100) * intval($discounts[\'percent\']);\\n        $discounts[\'percent_abs\'] = $tmp;\\n    }\\n    else {\\n        $discounts[\'percent_abs\'] = 0;\\n    }\\n\\n    $discount = $discounts[\'absolute\'] > $discounts[\'percent_abs\']\\n        ? $discounts[\'absolute\']\\n        : $discounts[\'percent\'];\\n}\\n\\n$arr = array(\\n    \'sale_discount\' => $discount,\\n    \'remains\' => $discounts[\'remains\'] > 0 ? $discounts[\'remains\'] : 0,\\n);\\nif ($mode == \'standalone\') {\\n    $pdoTools->config[\'nestedChunkPrefix\'] = \'minishop2_\';\\n\\n    return !empty($tpl)\\n        ? $pdoTools->getChunk($tpl, $arr)\\n        : print_r($arr, true);\\n}\\nelseif (!empty($row)) {\\n    $row = array_merge($row, $arr);\\n\\n    return $modx->toJSON($row);\\n}"}',
        'guid' => '4485f01d8adb363fec56b9c3b6c3abf1',
        'native_key' => 0,
        'signature' => '8bf7f2ea5261a6aa2ed87fec043937cd',
      ),
    ),
    'Plugins' => 
    array (
      '63a7e67741e777d43082402fa6587bc7' => 
      array (
        'preserve_keys' => false,
        'update_object' => true,
        'unique_key' => 'name',
        'class' => 'modPlugin',
        'object' => '{"id":null,"source":1,"property_preprocess":0,"name":"msDiscount","description":"","editor_type":0,"category":0,"cache_type":0,"plugincode":"\\/** @var msDiscount $msDiscount *\\/\\n$msDiscount = $modx->getService(\'msDiscount\');\\n\\nswitch ($modx->event->name) {\\n\\n\\tcase \'msOnGetProductPrice\':\\n\\t\\tif ($modx->context->key == \'mgr\') {return;}\\n\\t\\t\\/**\\n\\t\\t * Counts discount of current product for current user, based on rules in msDiscount component\\n\\t\\t * New price must be set in $modx->event->returnedValues[\'price\']\\n\\t\\t *\\n\\t\\t * @var msProductData $product Object with product properties\\n\\t\\t * @var array $data Array with product properties. Can be empty!\\n\\t\\t * @var float $price Current price of product\\n\\t\\t *\\/\\n\\t\\tif (!isset($modx->event->returnedValues[\'price\'])) {\\n\\t\\t\\t$modx->event->returnedValues[\'price\'] = $price;\\n\\t\\t}\\n\\t\\t\\/\\/ Get link to product price\\n\\t\\t$price = & $modx->event->returnedValues[\'price\'];\\n\\t\\t$new_price = $msDiscount->getNewPrice($product->id, $price);\\n\\t\\tif ($new_price !== false) {\\n\\t\\t\\t$price = $new_price;\\n\\t\\t}\\n\\t\\tbreak;\\n\\n\\tcase \'msOnChangeOrderStatus\':\\n\\t\\t\\/**\\n\\t\\t * Add user to discounts group if he spent required sum for join\\n\\t\\t *\\n\\t\\t * @var msOrder $order\\n\\t\\t * @var integer $status\\n\\t\\t *\\/\\n\\t\\tif ($status != 2) {return;}\\n\\n\\t\\t\\/** @var modUser $user *\\/\\n\\t\\tif ($user = $order->getOne(\'User\')) {\\n\\t\\t\\tif ($profile = $modx->getObject(\'msCustomerProfile\', $user->id)) {\\n\\t\\t\\t\\t$spent = $profile->spent;\\n\\t\\t\\t\\tif ($spent > 0) {\\n\\t\\t\\t\\t\\t$q = $modx->newQuery(\'msdUserGroup\');\\n\\t\\t\\t\\t\\t$q->where(\'joinsum > 0\');\\n\\t\\t\\t\\t\\t$q->select(\'id,joinsum\');\\n\\t\\t\\t\\t\\tif ($q->prepare() && $q->stmt->execute()) {\\n\\t\\t\\t\\t\\t\\t$groups = $msDiscount->getUserGroups($user->id);\\n\\t\\t\\t\\t\\t\\twhile ($row = $q->stmt->fetch(PDO::FETCH_ASSOC)) {\\n\\t\\t\\t\\t\\t\\t\\tif ($spent > $row[\'joinsum\'] && !isset($groups[$row[\'id\']])) {\\n\\t\\t\\t\\t\\t\\t\\t\\t$user->joinGroup((integer) $row[\'id\'], 1);\\n\\t\\t\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t}\\n\\t\\t\\t}\\n\\t\\t}\\n\\t\\tbreak;\\n\\n\\tcase \'msOnBeforeAddToOrder\':\\n\\t\\t\\/** @var string $key *\\/\\n\\t\\tif ($key == \'coupon_code\' && !empty($value)) {\\n\\t\\t\\t$check = $msDiscount->checkCoupon($value);\\n\\t\\t\\tif ($check !== true) {\\n\\t\\t\\t\\t$modx->event->output($check);\\n\\t\\t\\t}\\n\\t\\t}\\n\\t\\tbreak;\\n\\n\\tcase \'msOnGetOrderCost\':\\n\\t\\t\\/** @var float $cost *\\/\\n\\t\\tif (!empty($with_cart) && !empty($cost)) {\\n\\t\\t\\t\\/**@var msOrderInterface $order *\\/\\n\\t\\t\\tif ($data = $order->get()) {\\n\\t\\t\\t\\tif (!empty($data[\'coupon_code\']) && $msDiscount->checkCoupon($data[\'coupon_code\']) === true) {\\n\\t\\t\\t\\t\\t$order_cost = $cost;\\n\\t\\t\\t\\t\\tif ($modx->getOption(\'msd_coupon_only_products\', null, true)) {\\n\\t\\t\\t\\t\\t\\t\\/** @var msCartHandler $cart *\\/\\n\\t\\t\\t\\t\\t\\t$tmp = $cart->status();\\n\\t\\t\\t\\t\\t\\t$order_cost = $tmp[\'total_cost\'];\\n\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t\\tif ($discount = $msDiscount->getCouponDiscount($data[\'coupon_code\'], $order_cost)) {\\n\\t\\t\\t\\t\\t\\t$cost -= $discount;\\n\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t\\tif ($cost >= 0) {\\n\\t\\t\\t\\t\\t\\t$modx->event->returnedValues[\'cost\'] = $cost;\\n\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t}\\n\\t\\t\\t}\\n\\t\\t}\\n\\t\\tbreak;\\n\\n\\tcase \'msOnCreateOrder\':\\n\\t\\t\\/**@var msOrderInterface $order *\\/\\n\\t\\tif ($data = $order->get()) {\\n\\t\\t\\t\\/**@var msdCoupon $coupon *\\/\\n\\t\\t\\tif (!empty($data[\'coupon_code\']) && $coupon = $modx->getObject(\'msdCoupon\', array(\'code\' => $data[\'coupon_code\']))) {\\n\\t\\t\\t\\t\\/**@var msOrder $msOrder *\\/\\n\\t\\t\\t\\t$coupon->fromArray(array(\\n\\t\\t\\t\\t\\t\'active\' => false,\\n\\t\\t\\t\\t\\t\'activatedon\' => date(\'Y-m-d H:i:s\'),\\n\\t\\t\\t\\t\\t\'order_id\' => $msOrder->get(\'id\'),\\n\\t\\t\\t\\t));\\n\\t\\t\\t\\t$coupon->save();\\n\\t\\t\\t\\t$properties = $msOrder->get(\'properties\');\\n\\t\\t\\t\\tif (!is_array($properties)) {\\n\\t\\t\\t\\t\\t$properties = array();\\n\\t\\t\\t\\t}\\n\\t\\t\\t\\t$properties[\'coupon_code\'] = $coupon->get(\'code\');\\n\\t\\t\\t\\tif ($group = $coupon->getOne(\'Group\')) {\\n\\t\\t\\t\\t\\t$properties[\'coupon_discount\'] = $group->get(\'discount\');\\n\\t\\t\\t\\t}\\n\\t\\t\\t\\t$msOrder->set(\'properties\', $properties);\\n\\t\\t\\t\\t$msOrder->save();\\n\\t\\t\\t}\\n\\t\\t}\\n\\t\\tbreak;\\n\\n\\tcase \'OnWebLogin\':\\n\\tcase \'OnWebLogout\':\\n\\t\\t\\/** Set flag for cart reload *\\/\\n\\t\\t$_SESSION[\'minishop2\'][\'cart_reload\'] = true;\\n\\t\\tbreak;\\n\\n\\tcase \'OnLoadWebDocument\':\\n\\t\\t\\/**\\n\\t\\t * Recalculate cart of user if flag is set\\n\\t\\t * @var miniShop2 $miniShop2\\n\\t\\t *\\/\\n\\t\\tif (empty($_SESSION[\'minishop2\'][\'cart_reload\'])) {return;}\\n\\n\\t\\t$miniShop2 = $modx->getService(\'miniShop2\');\\n\\t\\t$miniShop2->initialize($modx->context->key);\\n\\n\\t\\t$cart = $miniShop2->cart->get();\\n\\t\\tif (!empty($cart)) {\\n\\t\\t\\tforeach ($cart as $key => $item) {\\n\\t\\t\\t\\t\\/** @var msProduct $product *\\/\\n\\t\\t\\t\\tif ($product = $modx->getObject(\'msProductData\', $item[\'id\'])) {\\n\\t\\t\\t\\t\\t$cart[$key][\'price\'] = $product->getPrice();\\n\\t\\t\\t\\t}\\n\\t\\t\\t}\\n\\t\\t\\t$miniShop2->cart->set($cart);\\n\\t\\t}\\n\\t\\tunset($_SESSION[\'minishop2\'][\'cart_reload\']);\\n\\t\\tbreak;\\n}","locked":0,"properties":null,"disabled":0,"moduleguid":"","static":0,"static_file":"core\\/components\\/msdiscount\\/elements\\/plugins\\/plugin.msdiscount.php","content":"\\/** @var msDiscount $msDiscount *\\/\\n$msDiscount = $modx->getService(\'msDiscount\');\\n\\nswitch ($modx->event->name) {\\n\\n\\tcase \'msOnGetProductPrice\':\\n\\t\\tif ($modx->context->key == \'mgr\') {return;}\\n\\t\\t\\/**\\n\\t\\t * Counts discount of current product for current user, based on rules in msDiscount component\\n\\t\\t * New price must be set in $modx->event->returnedValues[\'price\']\\n\\t\\t *\\n\\t\\t * @var msProductData $product Object with product properties\\n\\t\\t * @var array $data Array with product properties. Can be empty!\\n\\t\\t * @var float $price Current price of product\\n\\t\\t *\\/\\n\\t\\tif (!isset($modx->event->returnedValues[\'price\'])) {\\n\\t\\t\\t$modx->event->returnedValues[\'price\'] = $price;\\n\\t\\t}\\n\\t\\t\\/\\/ Get link to product price\\n\\t\\t$price = & $modx->event->returnedValues[\'price\'];\\n\\t\\t$new_price = $msDiscount->getNewPrice($product->id, $price);\\n\\t\\tif ($new_price !== false) {\\n\\t\\t\\t$price = $new_price;\\n\\t\\t}\\n\\t\\tbreak;\\n\\n\\tcase \'msOnChangeOrderStatus\':\\n\\t\\t\\/**\\n\\t\\t * Add user to discounts group if he spent required sum for join\\n\\t\\t *\\n\\t\\t * @var msOrder $order\\n\\t\\t * @var integer $status\\n\\t\\t *\\/\\n\\t\\tif ($status != 2) {return;}\\n\\n\\t\\t\\/** @var modUser $user *\\/\\n\\t\\tif ($user = $order->getOne(\'User\')) {\\n\\t\\t\\tif ($profile = $modx->getObject(\'msCustomerProfile\', $user->id)) {\\n\\t\\t\\t\\t$spent = $profile->spent;\\n\\t\\t\\t\\tif ($spent > 0) {\\n\\t\\t\\t\\t\\t$q = $modx->newQuery(\'msdUserGroup\');\\n\\t\\t\\t\\t\\t$q->where(\'joinsum > 0\');\\n\\t\\t\\t\\t\\t$q->select(\'id,joinsum\');\\n\\t\\t\\t\\t\\tif ($q->prepare() && $q->stmt->execute()) {\\n\\t\\t\\t\\t\\t\\t$groups = $msDiscount->getUserGroups($user->id);\\n\\t\\t\\t\\t\\t\\twhile ($row = $q->stmt->fetch(PDO::FETCH_ASSOC)) {\\n\\t\\t\\t\\t\\t\\t\\tif ($spent > $row[\'joinsum\'] && !isset($groups[$row[\'id\']])) {\\n\\t\\t\\t\\t\\t\\t\\t\\t$user->joinGroup((integer) $row[\'id\'], 1);\\n\\t\\t\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t}\\n\\t\\t\\t}\\n\\t\\t}\\n\\t\\tbreak;\\n\\n\\tcase \'msOnBeforeAddToOrder\':\\n\\t\\t\\/** @var string $key *\\/\\n\\t\\tif ($key == \'coupon_code\' && !empty($value)) {\\n\\t\\t\\t$check = $msDiscount->checkCoupon($value);\\n\\t\\t\\tif ($check !== true) {\\n\\t\\t\\t\\t$modx->event->output($check);\\n\\t\\t\\t}\\n\\t\\t}\\n\\t\\tbreak;\\n\\n\\tcase \'msOnGetOrderCost\':\\n\\t\\t\\/** @var float $cost *\\/\\n\\t\\tif (!empty($with_cart) && !empty($cost)) {\\n\\t\\t\\t\\/**@var msOrderInterface $order *\\/\\n\\t\\t\\tif ($data = $order->get()) {\\n\\t\\t\\t\\tif (!empty($data[\'coupon_code\']) && $msDiscount->checkCoupon($data[\'coupon_code\']) === true) {\\n\\t\\t\\t\\t\\t$order_cost = $cost;\\n\\t\\t\\t\\t\\tif ($modx->getOption(\'msd_coupon_only_products\', null, true)) {\\n\\t\\t\\t\\t\\t\\t\\/** @var msCartHandler $cart *\\/\\n\\t\\t\\t\\t\\t\\t$tmp = $cart->status();\\n\\t\\t\\t\\t\\t\\t$order_cost = $tmp[\'total_cost\'];\\n\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t\\tif ($discount = $msDiscount->getCouponDiscount($data[\'coupon_code\'], $order_cost)) {\\n\\t\\t\\t\\t\\t\\t$cost -= $discount;\\n\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t\\tif ($cost >= 0) {\\n\\t\\t\\t\\t\\t\\t$modx->event->returnedValues[\'cost\'] = $cost;\\n\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t}\\n\\t\\t\\t}\\n\\t\\t}\\n\\t\\tbreak;\\n\\n\\tcase \'msOnCreateOrder\':\\n\\t\\t\\/**@var msOrderInterface $order *\\/\\n\\t\\tif ($data = $order->get()) {\\n\\t\\t\\t\\/**@var msdCoupon $coupon *\\/\\n\\t\\t\\tif (!empty($data[\'coupon_code\']) && $coupon = $modx->getObject(\'msdCoupon\', array(\'code\' => $data[\'coupon_code\']))) {\\n\\t\\t\\t\\t\\/**@var msOrder $msOrder *\\/\\n\\t\\t\\t\\t$coupon->fromArray(array(\\n\\t\\t\\t\\t\\t\'active\' => false,\\n\\t\\t\\t\\t\\t\'activatedon\' => date(\'Y-m-d H:i:s\'),\\n\\t\\t\\t\\t\\t\'order_id\' => $msOrder->get(\'id\'),\\n\\t\\t\\t\\t));\\n\\t\\t\\t\\t$coupon->save();\\n\\t\\t\\t\\t$properties = $msOrder->get(\'properties\');\\n\\t\\t\\t\\tif (!is_array($properties)) {\\n\\t\\t\\t\\t\\t$properties = array();\\n\\t\\t\\t\\t}\\n\\t\\t\\t\\t$properties[\'coupon_code\'] = $coupon->get(\'code\');\\n\\t\\t\\t\\tif ($group = $coupon->getOne(\'Group\')) {\\n\\t\\t\\t\\t\\t$properties[\'coupon_discount\'] = $group->get(\'discount\');\\n\\t\\t\\t\\t}\\n\\t\\t\\t\\t$msOrder->set(\'properties\', $properties);\\n\\t\\t\\t\\t$msOrder->save();\\n\\t\\t\\t}\\n\\t\\t}\\n\\t\\tbreak;\\n\\n\\tcase \'OnWebLogin\':\\n\\tcase \'OnWebLogout\':\\n\\t\\t\\/** Set flag for cart reload *\\/\\n\\t\\t$_SESSION[\'minishop2\'][\'cart_reload\'] = true;\\n\\t\\tbreak;\\n\\n\\tcase \'OnLoadWebDocument\':\\n\\t\\t\\/**\\n\\t\\t * Recalculate cart of user if flag is set\\n\\t\\t * @var miniShop2 $miniShop2\\n\\t\\t *\\/\\n\\t\\tif (empty($_SESSION[\'minishop2\'][\'cart_reload\'])) {return;}\\n\\n\\t\\t$miniShop2 = $modx->getService(\'miniShop2\');\\n\\t\\t$miniShop2->initialize($modx->context->key);\\n\\n\\t\\t$cart = $miniShop2->cart->get();\\n\\t\\tif (!empty($cart)) {\\n\\t\\t\\tforeach ($cart as $key => $item) {\\n\\t\\t\\t\\t\\/** @var msProduct $product *\\/\\n\\t\\t\\t\\tif ($product = $modx->getObject(\'msProductData\', $item[\'id\'])) {\\n\\t\\t\\t\\t\\t$cart[$key][\'price\'] = $product->getPrice();\\n\\t\\t\\t\\t}\\n\\t\\t\\t}\\n\\t\\t\\t$miniShop2->cart->set($cart);\\n\\t\\t}\\n\\t\\tunset($_SESSION[\'minishop2\'][\'cart_reload\']);\\n\\t\\tbreak;\\n}"}',
        'guid' => '8da88a7403c711a9294cb21173162d40',
        'native_key' => NULL,
        'signature' => '3fdf3f564c398abc7102800f3032193b',
        'related_objects' => 
        array (
          'PluginEvents' => 
          array (
            '1eb02c5184c86a44406d0b6b70ef0531' => 
            array (
              'preserve_keys' => true,
              'update_object' => true,
              'unique_key' => 
              array (
                0 => 'pluginid',
                1 => 'event',
              ),
              'class' => 'modPluginEvent',
              'object' => '{"pluginid":0,"event":"msOnGetProductPrice","priority":0,"propertyset":0}',
              'guid' => '982a8bdd40994dc475e25d486627656c',
              'native_key' => 
              array (
                0 => 0,
                1 => 'msOnGetProductPrice',
              ),
              'signature' => '7dd1f100b1de3b736103dfbf9920e4fe',
            ),
            '46acb51dbe080ddca5a9da24a37d4ba6' => 
            array (
              'preserve_keys' => true,
              'update_object' => true,
              'unique_key' => 
              array (
                0 => 'pluginid',
                1 => 'event',
              ),
              'class' => 'modPluginEvent',
              'object' => '{"pluginid":0,"event":"msOnChangeOrderStatus","priority":10,"propertyset":0}',
              'guid' => '5d5f6c67785c8b3ef4e026e33e732922',
              'native_key' => 
              array (
                0 => 0,
                1 => 'msOnChangeOrderStatus',
              ),
              'signature' => 'b74f2ae20eba5dada479b40381e419bb',
            ),
            'b26b239b21262e76cd2e238562da5314' => 
            array (
              'preserve_keys' => true,
              'update_object' => true,
              'unique_key' => 
              array (
                0 => 'pluginid',
                1 => 'event',
              ),
              'class' => 'modPluginEvent',
              'object' => '{"pluginid":0,"event":"msOnBeforeAddToOrder","priority":0,"propertyset":0}',
              'guid' => '8cfcc9a935ca547e682ef0872b47fec6',
              'native_key' => 
              array (
                0 => 0,
                1 => 'msOnBeforeAddToOrder',
              ),
              'signature' => 'dcb7bd60aaa2fc23d1ff0ace7ddb2687',
            ),
            '4a486bd2f2bf47b73b5e8d18ac4dcd2e' => 
            array (
              'preserve_keys' => true,
              'update_object' => true,
              'unique_key' => 
              array (
                0 => 'pluginid',
                1 => 'event',
              ),
              'class' => 'modPluginEvent',
              'object' => '{"pluginid":0,"event":"msOnGetOrderCost","priority":10,"propertyset":0}',
              'guid' => '8d8a5ec4719b1ee7126d1675d6f010ad',
              'native_key' => 
              array (
                0 => 0,
                1 => 'msOnGetOrderCost',
              ),
              'signature' => 'b0d7a36f124aeaf7fa7135326354d585',
            ),
            '9a730ab24dfd36da068cfbeb7094d1ff' => 
            array (
              'preserve_keys' => true,
              'update_object' => true,
              'unique_key' => 
              array (
                0 => 'pluginid',
                1 => 'event',
              ),
              'class' => 'modPluginEvent',
              'object' => '{"pluginid":0,"event":"msOnCreateOrder","priority":0,"propertyset":0}',
              'guid' => '3684da57cbc43dc1cd703208b47a2a72',
              'native_key' => 
              array (
                0 => 0,
                1 => 'msOnCreateOrder',
              ),
              'signature' => 'dad7518db5d720e5eb4613fb0e354651',
            ),
            '9fd86f59b446453960d49fe7e310e410' => 
            array (
              'preserve_keys' => true,
              'update_object' => true,
              'unique_key' => 
              array (
                0 => 'pluginid',
                1 => 'event',
              ),
              'class' => 'modPluginEvent',
              'object' => '{"pluginid":0,"event":"OnWebLogin","priority":0,"propertyset":0}',
              'guid' => 'd042e7c70eca9895fdbd4f95d697af6b',
              'native_key' => 
              array (
                0 => 0,
                1 => 'OnWebLogin',
              ),
              'signature' => 'fe6ee86ba6ff29b652a55d91aa6bd4ea',
            ),
            'bb5c580ed9b6972aa563fe2bfc9c3a7d' => 
            array (
              'preserve_keys' => true,
              'update_object' => true,
              'unique_key' => 
              array (
                0 => 'pluginid',
                1 => 'event',
              ),
              'class' => 'modPluginEvent',
              'object' => '{"pluginid":0,"event":"OnWebLogout","priority":0,"propertyset":0}',
              'guid' => '0dd5e3562963c9cb71513e6133ab47b9',
              'native_key' => 
              array (
                0 => 0,
                1 => 'OnWebLogout',
              ),
              'signature' => '04b2985b08cd64b6755ab2c656918e25',
            ),
            'ff20f71c45c41ed7a54df2488f8c75b4' => 
            array (
              'preserve_keys' => true,
              'update_object' => true,
              'unique_key' => 
              array (
                0 => 'pluginid',
                1 => 'event',
              ),
              'class' => 'modPluginEvent',
              'object' => '{"pluginid":0,"event":"OnLoadWebDocument","priority":0,"propertyset":0}',
              'guid' => 'f2f46d91ebdd02abe21c8624bdece279',
              'native_key' => 
              array (
                0 => 0,
                1 => 'OnLoadWebDocument',
              ),
              'signature' => '22dbf38c70cea30a6f63eefa92d3575f',
            ),
          ),
        ),
      ),
    ),
  ),
  'related_object_attributes' => 
  array (
    'Snippets' => 
    array (
      'preserve_keys' => false,
      'update_object' => true,
      'unique_key' => 'name',
    ),
    'Chunks' => 
    array (
      'preserve_keys' => false,
      'update_object' => false,
      'unique_key' => 'name',
    ),
    'Plugins' => 
    array (
      'preserve_keys' => false,
      'update_object' => true,
      'unique_key' => 'name',
    ),
    'PluginEvents' => 
    array (
      'preserve_keys' => true,
      'update_object' => true,
      'unique_key' => 
      array (
        0 => 'pluginid',
        1 => 'event',
      ),
    ),
  ),
  'namespace' => 'msdiscount',
  'resolve' => 
  array (
    0 => 
    array (
      'type' => 'file',
      'body' => '{"source":"msdiscount-1.3.2-pl\\/modCategory\\/84e2f16c6e869a02ab4b01405611b671\\/0\\/","target":"return MODX_ASSETS_PATH . \'components\\/\';","name":"msdiscount"}',
    ),
    1 => 
    array (
      'type' => 'file',
      'body' => '{"source":"msdiscount-1.3.2-pl\\/modCategory\\/84e2f16c6e869a02ab4b01405611b671\\/1\\/","target":"return MODX_CORE_PATH . \'components\\/\';","name":"msdiscount"}',
    ),
    2 => 
    array (
      'type' => 'php',
      'body' => '{"source":"msdiscount-1.3.2-pl\\/modCategory\\/84e2f16c6e869a02ab4b01405611b671.resolve.tables.resolver","type":"php","name":"resolve.tables"}',
    ),
    3 => 
    array (
      'type' => 'php',
      'body' => '{"source":"msdiscount-1.3.2-pl\\/modCategory\\/84e2f16c6e869a02ab4b01405611b671.resolve.extension.resolver","type":"php","name":"resolve.extension"}',
    ),
    4 => 
    array (
      'type' => 'php',
      'body' => '{"source":"msdiscount-1.3.2-pl\\/modCategory\\/84e2f16c6e869a02ab4b01405611b671.resolve.policy.resolver","type":"php","name":"resolve.policy"}',
    ),
    5 => 
    array (
      'type' => 'php',
      'body' => '{"source":"msdiscount-1.3.2-pl\\/modCategory\\/84e2f16c6e869a02ab4b01405611b671.resolve.setup.resolver","type":"php","name":"resolve.setup"}',
    ),
  ),
  'validate' => NULL,
  'vehicle_package' => 'transport',
  'vehicle_class' => 'xPDOObjectVehicle',
  'guid' => '9cac884a3ae294268aafdeedd677c57d',
  'package' => 'modx',
  'class' => 'modCategory',
  'signature' => '84e2f16c6e869a02ab4b01405611b671',
  'native_key' => NULL,
  'object' => '{"id":null,"parent":0,"category":"msDiscount","rank":0}',
);